
@{
    ViewData["Title"] = "All";
}

<link href="~/css/patient/all.css" rel="stylesheet" asp-append-version="true" />

<div class="content">
    <h1>Все пациенты</h1>

    <input type="text" class="search-panel" id="search" placeholder="Поиск (ФИО СНИЛС)" />

    <table class="patients-table">
        <thead>
            <tr>
                <th>Фамилия</th>
                <th>Имя</th>
                <th>Отчество</th>
                <th>СНИЛС</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var pacient in Model)
            {
                <tr onclick="" class="patient-line">
                    <td>@pacient.Surname</td>
                    <td>@pacient.Name</td>
                    <td>@pacient.Patronymic</td>
                    <td>@pacient.SNILS</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () {

        document.getElementById("search").addEventListener("input", function (e) {
            let searchWords = e.target.value.split(' ').filter(x => x.length != 0);

            for (let line of document.getElementsByClassName("patient-line")) {
                line.classList.remove("hide");
                for (let word of searchWords) {
                    if (!lineContainWord(line, word)) {
                        line.classList.add("hide");
                    }
                }
            }
        });

    });

    function lineContainWord(HTML_line, word) {
        var regex = new RegExp("^" + word);
        for (let cell of HTML_line.children) {
            if (regex.test(cell.innerText)) return true;
        }
        return false;
    }

</script>